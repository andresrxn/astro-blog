---
import BlogPost from '../../components/BlogPost.astro'
import BaseLayout from '../../layouts/BaseLayout.astro'
import { capitalize } from '../../utils/global'

export async function getStaticPaths() {
  const allPosts = await Astro.glob('../posts/*.md')
  const uniqueTags = [
    ...new Set(allPosts.map(post => post.frontmatter.tags).flat())
  ]

  return uniqueTags.map(tag => {
    const filteredPosts = allPosts.filter(post =>
      post.frontmatter.tags.includes(tag)
    )
    return {
      params: { tag },
      props: { posts: filteredPosts }
    }
  })
}

const { tag } = Astro.params
const { posts } = Astro.props
---

<BaseLayout pageTitle={capitalize(tag)}>
  <p>Entradas etiquetadas con {tag}</p>
  <ul>
    {
      posts.map(post => (
        <BlogPost
          url={post.url}
          title={post.frontmatter.title}
          imageURL={post.frontmatter.image.url}
          description={post.frontmatter.description}
        />
      ))
    }
  </ul>
</BaseLayout>

<style>
  ul {
    margin-top: 40px;
    display: grid;
    gap: 20px;
    padding: 0;
  }
</style>
